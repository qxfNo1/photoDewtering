{% extends 'base.html' %}   {# 将当前页面继承至base.html母版 #}
{% block content %}
  <link rel="stylesheet" href="/css/paint.css">
  <script>
    var canvas;
    var context;

    // 初始化
    window.onload = function() {
      // 获取画布已经绘图上下文
      canvas = document.getElementById("drawingCanvas");
      context = canvas.getContext("2d");

      // 画布添加鼠标事件
      canvas.onmousedown = startDrawing;
      canvas.onmouseup = stopDrawing;
      canvas.onmouseout = stopDrawing;
      canvas.onmousemove = draw;
    };

    // 记录当前是否在画图
    var isDrawing = false;

    // 开始画图
    function startDrawing(e) {
      isDrawing = true;
      // 创建一个新的绘图路径
      context.beginPath();
      // 把画笔移动到鼠标位置
      context.moveTo(e.pageX - canvas.offsetLeft, e.pageY - canvas.offsetTop);
    }

    // 停止画图
    function stopDrawing() {
      isDrawing = false;
    }

    //画图中
    function draw(e) {
      if (isDrawing == true) {
        // 找到鼠标最新位置
        var x = e.pageX - canvas.offsetLeft;
        var y = e.pageY - canvas.offsetTop;
        // 画一条直线到鼠标最新位置
        context.lineTo(x, y);
        context.stroke();
      }
    }

    // 保存之前选择的颜色的画笔 <img> 元素标签
    var previousColorElement;

    // 改变画笔颜色
    function changeColor(color, imgElement) {
      context.strokeStyle = color;
      // 将当前画笔的 <img> 元素标签设置为选中样式
      imgElement.className = "Selected";
      // 将之前的画笔的 <img> 元素标签恢复默认样式
      if (previousColorElement != null) previousColorElement.className = "";
      previousColorElement = imgElement;
    }

    // 保存之前选择的粗细的画笔 <img> 元素标签
    var previousThicknessElement;

    // 改变画笔粗细
    function changeThickness(thickness, imgElement) {
      context.lineWidth = thickness;
      // 将当前画笔的 <img> 元素标签设置为选中样式
      imgElement.className = "Selected";
      // 将之前的画笔的 <img> 元素标签恢复默认样式
      if (previousThicknessElement != null) previousThicknessElement.className = "";
      previousThicknessElement = imgElement;
    }

    // 清除画布
    function clearCanvas() {
      context.clearRect(0, 0, canvas.width, canvas.height);
    }

    // 保存画布
    function saveCanvas() {
      // 找到预览的 <img> 元素标签
      var imageCopy = document.getElementById("savedImageCopy");
      // 将画布内容在img元素中显示
      imageCopy.src = canvas.toDataURL();
      // 显示右键保存的提示
      var imageContainer = document.getElementById("savedCopyContainer");
      imageContainer.style.display = "block";
    }
  </script>
  <div class="btn-group" role="group">
    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
      - 颜色 -
      <span class="caret"></span>
    </button>
    <ul class="dropdown-menu">
      <li><img id="redPen" src="pen_red.gif" alt="红色" onclick="changeColor('rgb(212,21,29)', this)"></li>
      <li><img id="greenPen" src="pen_green.gif" alt="绿色" onclick="changeColor('rgb(131,190,61)', this)"></li>
      <li><img id="bluePen" src="pen_blue.gif" alt="蓝色" onclick="changeColor('rgb(0,86,166)', this)"></li>
    </ul>
  </div>


{#        - 颜色 -<br>#}
{#        <img id="redPen" src="pen_red.gif" alt="红色" onclick="changeColor('rgb(212,21,29)', this)"><br>#}
{#        <img id="greenPen" src="pen_green.gif" alt="绿色" onclick="changeColor('rgb(131,190,61)', this)"><br>#}
{#        <img id="bluePen" src="pen_blue.gif" alt="蓝色" onclick="changeColor('rgb(0,86,166)', this)"><br>#}
{#       <img id="redPen" src="pen_red.gif" alt="白色" onclick="changeColor('rgb(255,255,255)', this)"><br>#}
{#        <img id="greenPen" src="pen_green.gif" alt="紫色" onclick="changeColor('rgb(128, 0, 128)', this)"><br>#}
{#        <img id="bluePen" src="pen_blue.gif" alt="橙色" onclick="changeColor('rgb(200,96,35)', this)"><br>#}
{#       <img id="redPen" src="pen_red.gif" alt="黄色" onclick="changeColor('rgb(255,255,0)', this)"><br>#}
{#        <img id="greenPen" src="pen_green.gif" alt="青色" onclick="changeColor('rgb(0,255,255)', this)"><br>#}
{#        <img id="bluePen" src="pen_blue.gif" alt="粉色" onclick="changeColor('rgb(255,192,203)', this)">#}
{#      </div>#}
      <div class="col-1 Toolbar">
        - 粗细 -<br>
        <img src="pen_thin.gif" alt="1" onclick="changeThickness(1, this)"><br>
        <img src="pen_medium.gif" alt="2" onclick="changeThickness(2, this)"><br>
        <img src="pen_thick.gif" alt="3" onclick="changeThickness(3, this)"><br>
      <img src="pen_thin.gif" alt="4" onclick="changeThickness(4, this)"><br>
        <img src="pen_medium.gif" alt="5" onclick="changeThickness(5, this)"><br>
        <img src="pen_thick.gif" alt="6" onclick="changeThickness(6, this)"><br>
      <img src="pen_thin.gif" alt="7" onclick="changeThickness(7, this)"><br>
        <img src="pen_medium.gif" alt="8" onclick="changeThickness(8, this)"><br>
        <img src="pen_thick.gif" alt="9" onclick="changeThickness(9, this)"><br>
      <img src="pen_thin.gif" alt="10" onclick="changeThickness(10, this)"><br>
        <img src="pen_medium.gif" alt="11" onclick="changeThickness(11, this)"><br>
        <img src="pen_thick.gif" alt="12" onclick="changeThickness(12, this)"><br>
      <img src="pen_thin.gif" alt="12" onclick="changeThickness(13, this)"><br>
        <img src="pen_medium.gif" alt="14" onclick="changeThickness(14, this)"><br>
        <img src="pen_thick.gif" alt="15" onclick="changeThickness(15, this)">
      </div>
      <div class="col-8 CanvasContainer">
        <canvas id="drawingCanvas" width="800" height="400"></canvas>
      </div>
     <div class="col-1 Toolbar">
        - 操作 -<br>

        <button onclick="saveCanvas()">保存图像</button>
        <button onclick="clearCanvas()">清除图像</button>
            <div id="savedCopyContainer">
              <img id="savedImageCopy"><br>
              使用右键保存图像 ...
            </div>
      </div>


{% endblock %}
